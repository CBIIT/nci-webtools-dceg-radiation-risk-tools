{% load staticfiles %}
{% load compress %}

<!DOCTYPE html>
<html lang="en">
	<head>
		<!--<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" /> -->
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="icon" type="image/ico" href="{% static "img/favicon.ico" %}" />
   		<title>I-131 Radiation Exposure - National Cancer Institute (NCI)</title>
		{% compress css %}
		<link type="text/css" rel="stylesheet" href="{% static 'css/base.css' %}">
		<link href="{% static 'select2/select2.css' %}" type="text/css" rel="stylesheet">
		{% endcompress %}
	</head>
	<body class="help-dialog">
		<a id="skip" href="#content-help">Skip to Main Content</a>
		<div id="content-help">
			<p class="help-lived">Select the state then county in which you lived.</p>
			<div>
				{{form.as_table}} 
				<p class="btn-county-save"><input type=button id="id_save" value="Save" class="btn btn-primary mt-1"></p>
			</div>
			<div id="id_map_section" style="display:none;">
				<p>On the map, click on the portion of the county where you lived.</p>
				<img id="id_county_map" src="{% static 'img/counties/ClarkNV.jpg' %}" border="1" alt="" align="middle" usemap="">
			</div>
			<map name="ClarkNVmap">
			  <area shape="poly" coords="143,28,391,28,392,190,367,235,317,200,226,208" href="#" class="county-map" state="NV" county="Clark1" alt="Clark1">
			  <area shape="poly" coords="21,28,143,28,226,208,116,331,20,240" href="#" class="county-map" state="NV" county="Clark2" alt="Clark2">
			  <area shape="poly" coords="226,208,266,271,266,380,281,400,285,450,273,487,116,331" href="#" class="county-map" state="NV" county="Clark3" alt="Clark3">
			</map>
			<map name="Box_ElderUTmap">
			  <area shape="poly" coords="25,25,256,24,360,178,367,238,274,237,288,300,25,299" href="#" class="county-map" state="UT" county="Box Elder1" alt="Box Elder1">
			  <area shape="poly" coords="256,24,413,24,445,81,439,108,449,152,464,150,468,183,439,207,392,208,360,178" href="#" class="county-map" state="UT" county="Box Elder2" alt="Box Elder2">
			</map>
			<map name="CoconinoAZmap">
			  <area shape="poly" coords="123,29,261,29,254,47,244,53,211,109,207,131,219,157,213,172,203,182,165,172,145,149,111,125,113,64" href="#" class="county-map" state="AZ" county="Coconino1" alt="Coconino1">
			  <area shape="poly" coords="261,29,354,29,354,227,292,220,241,202,213,172,219,157,207,131,211,109,244,53,254,47" href="#" class="county-map" state="AZ" county="Coconino2" alt="Coconino2">
			  <area shape="poly" coords="111,125,145,149,165,172,203,182,213,172,241,202,292,220,354,227,354,463,252,433,250,379,223,379,223,349,149,349,149,323,136,323,136,307,20,262,24,172" href="#" class="county-map" state="AZ" county="Coconino3" alt="Coconino3">
			</map>
			<map name="EsmeraldaNVmap">
			  <area shape="poly" coords="191,2,255,76,102,252,27,182" href="#" class="county-map" state="NV" county="Esmeralda1" alt="Esmeralda1">
			  <area shape="poly" coords="255,76,315,142,312,448,102,252" href="#" class="county-map" state="NV" county="Esmeralda2" alt="Esmeralda2">
			</map>
			<map name="InyoCAmap">
			  <area shape="poly" coords="7,3,153,3,268,108,221,217,84,181,65,124,70,121,56,78,23,61" href="#" class="county-map" state="CA" county="Inyo1" alt="Inyo1">
			  <area shape="poly" coords="84,181,221,217,249,329,127,328,116,259" href="#" class="county-map" state="CA" county="Inyo2" alt="Inyo2">
			  <area shape="poly" coords="268,108,493,325,480,329,249,329,221,217" href="#" class="county-map" state="CA" county="Inyo3" alt="Inyo3">
			</map>
			<map name="IronUTmap">
			  <area shape="poly" coords="9,24,276,24,196,248,9,251" href="#" class="county-map" state="UT" county="Iron1" alt="Iron1">
			  <area shape="poly" coords="309,24,526,24,526,132,492,132,492,167,455,167,455,277,385,276" href="#" class="county-map" state="UT" county="Iron2" alt="Iron2">
			  <area shape="poly" coords="276,24,309,24,385,276,385,294,340,294,340,303,271,301,271,282,196,282,196,248" href="#" class="county-map" state="UT" county="Iron3" alt="Iron3">
			</map>
			<map name="KaneUTmap">
			  <area shape="poly" coords="191,28,608,24,530,157,420,203,17,201,17,85,191,85" href="#" class="county-map" state="UT" county="Kane1" alt="Kane1">
			  <area shape="poly" coords="17,23,191,28,191,85,17,85" href="#" class="county-map" state="UT" county="Kane2" alt="Kane2">
			</map>
			<map name="LanderNVmap" colorbox-height="825px">
			  <area shape="poly" coords="153,25,236,25,236,299,65,300,51,280,109,116,152,116" href="#" class="county-map" state="NV" county="Lander1" alt="Lander1">
			  <area shape="poly" coords="65,300,236,299,235,494,94,492,8,509,2,494,19,478,8,442,61,397" href="#" class="county-map" state="NV" county="Lander2" alt="Lander2">
			</map>
			<map name="LincolnNVmap">
			  <area shape="poly" coords="190,29,360,29,360,443,190,441" href="#" class="county-map" state="NV" county="Lincoln1" alt="Lincoln1">
			  <area shape="poly" coords="31,170,190,171,190,441,31,444" href="#" class="county-map" state="NV" county="Lincoln2" alt="Lincoln2">
			</map>
			<map name="MohaveAZmap">
			  <area shape="poly" coords="256,16,358,16,342,124,252,171" href="#" class="county-map" state="AZ" county="Mohave1" alt="Mohave1">
			  <area shape="poly" coords="156,16,256,16,252,171,252,213,239,224,228,219,158,147" href="#" class="county-map" state="AZ" county="Mohave2" alt="Mohave2">
			  <area shape="poly" coords="158,147,228,219,239,224,252,213,253,391,101,391,78,365,77,326,89,324,73,263,66,170,91,158,143,183" href="#" class="county-map" state="AZ" county="Mohave3" alt="Mohave3">
			  <area shape="poly" coords="101,391,253,391,253,461,224,459,205,475,156,464,119,435" href="#" class="county-map" state="AZ" county="Mohave4" alt="Mohave4">
			</map>
			<map name="NyeNVmap">
			  <area shape="poly" coords="14,53,106,31,199,31,197,115,101,162,15,64" href="#" class="county-map" state="NV" county="Nye1" alt="Nye1">
			  <area shape="poly" coords="199,31,260,31,359,97,359,183,263,182,263,254,126,254,126,191,101,162,197,115" href="#" class="county-map" state="NV" county="Nye2" alt="Nye2">
			  <area shape="poly" coords="126,254,263,254,263,462,126,329" href="#" class="county-map" state="NV" county="Nye3" alt="Nye3">
			</map>
			<map name="TooeleUTmap">
			  <area shape="poly" coords="4,22,262,22,262,332,4,332" href="#" class="county-map" state="UT" county="Tooele1" alt="Tooele1">
			  <area shape="poly" coords="262,22,336,41,351,108,368,115,401,101,412,252,405,303,381,332,262,332" href="#" class="county-map" state="UT" county="Tooele2" alt="Tooele2">
			</map>
			<map name="WashingtonUTmap">
			  <area shape="poly" coords="1,27,171,27,171,20,213,20,213,63,294,63,294,146,1,146" href="#" class="county-map" state="UT" county="Washington1" alt="Washington1">
			  <area shape="poly" coords="1,146,294,146,294,307,1,307" href="#" class="county-map" state="UT" county="Washington2" alt="Washington2">
			  <area shape="poly" coords="294,84,374,86,374,77,425,77,425,307,294,307" href="#" class="county-map" state="UT" county="Washington3" alt="Washington3">
			</map>
			<map name="White_PineNVmap">
			  <area shape="poly" coords="18,26,242,28,242,451,203,451,205,223,103,223,103,380,1,310,1,221,20,184" href="#" class="county-map" state="NV" county="White Pine1" alt="White Pine1">
			  <area shape="poly" coords="103,223,205,223,203,451,103,380" href="#" class="county-map" state="NV" county="White Pine2" alt="White Pine2">
			  <area shape="poly" coords="242,28,421,30,420,452,242,451" href="#" class="county-map" state="NV" county="White Pine3" alt="White Pine3">
			</map>
		</div>
	</body>

{% compress js %}
<script src="{% static 'js/calculator.js' %}" type="text/javascript"></script>
<script src="{% static 'js/jquery.rwdImageMaps.min.js' %}" type="text/javascript"></script>
{% endcompress %}
<script type="text/javascript">
var jQuery = parent.jQuery;
jQuery(document).ready( function() {
    $('img[usemap]').rwdImageMaps();
   
    jQuery('#id_state').on('change', function(event){
        jQuery('#id_map_section').hide();
        setCounties(jQuery(this).val(), 1);
    });
    jQuery('#id_county').on('change', function(event){
        setImageMap(jQuery('#id_state').val(),  jQuery(this).val(), 1);
    }); 
    jQuery('.county-map').on('click', function(event) {
        window.parent.setLocation('{{id_state}}', jQuery(this).attr('state'), jQuery('#id_state option:selected').text(), '{{id_county}}', jQuery(this).attr('county'));
        jQuery.colorbox.close();
        return false;
    });
    jQuery('#id_save').on('click', function() {
      window.parent.setLocation('{{id_state}}', jQuery('#id_state').val(), jQuery('#id_state option:selected').text(), '{{id_county}}', jQuery('#id_county').val());
      jQuery.colorbox.close();
      return false;
    });
    
    jQuery('#id_county').attr('disabled', jQuery('#id_state').val() == '' || jQuery('#id_county option').size() == 1).trigger("change");
    
    {% if state %}
    setCounties('{{state}}', 0);
    {% endif %}
    {% if county %}
    jQuery('#id_county').val('{{county_option}}').trigger("change");   
    setImageMap('{{state}}',  '{{county}}', 1);
    {% endif %}

    //jQuery('#id_save').attr('disabled', jQuery('#id_county').val() == '' && jQuery('#id_county option').size() != 1);
});
function setCounties(state, resize) {
    console.log('setCounties ' + state);
    jQuery.ajax({ async: false, url: "{% url 'get-counties' %}"+ '?state=' + state}).done(function(data) {
        jQuery("select[id='id_county']").find('option').remove();
        var optionsAsString = "";
        for(var i=0; i < data.length; i++) {
            optionsAsString += "<option value='" + data[i].value + "' has_map=" + data[i].has_map + ">" + data[i].label + "</option>";
        }
        jQuery("select[id='id_county']").append( optionsAsString );
        jQuery("select[id='id_county']").trigger("change"); 
    
        jQuery('#id_county').attr('disabled', jQuery('#id_state').val() == '' || jQuery('#id_state').val() == 'OU' || jQuery('#id_county').size() == 0).trigger("change");
        jQuery('#id_save').attr('disabled', jQuery('#id_state').val() != 'OU' || 
                                            jQuery('#id_county').size() == 0 || 
                                            jQuery('#id_county').find(":selected").attr('has_map') == 'true');
        if (resize)
            jQuery.colorbox.resize({width: getColorBoxWidth(600), height: "300px"});
    });
}
function setImageMap(state, county, resize) {
    console.log('setImageMap ' + state + county);
    var map = jQuery('#id_county_map');
    if (jQuery('#id_county').find(":selected").attr('has_map') == 'true') {
        console.log('has_map ');
        
        var usemap = ('#' + county + state + 'map').replace(' ', '_');
        map.attr('usemap', usemap);
        map.attr('alt', county + " County, " + state);
        
        var rr = map.attr('src').match(/counties\/\w+\.jpg$/);
        
        var imagename = 'counties/' + (county + state + '.jpg').replace(' ', '_');
        map.attr('src', map.attr('src').replace(/counties\/\w+\.jpg$/, imagename));
        jQuery('#id_save').attr('disabled', true);        
        jQuery('#id_map_section').show();
        if (resize)
            jQuery.colorbox.resize({width: getColorBoxWidth(600), height: '700px'});
    } else {
        jQuery('#id_map_section').hide();
        console.log(jQuery('#id_county').val() == '');
        console.log(jQuery('#id_county').size() == 0);
        console.log(jQuery('#id_county').find(":selected").attr('has_map') == 'true');
        
        jQuery('#id_save').attr('disabled', jQuery('#id_county').val() == '' || jQuery('#id_county').size() == 0 || jQuery('#id_county').find(":selected").attr('has_map') == 'true');
        if (resize)
            jQuery.colorbox.resize({width: getColorBoxWidth(600), height: "300px"});
    }    
}
</script>
</html>